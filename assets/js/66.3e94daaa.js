(window.webpackJsonp=window.webpackJsonp||[]).push([[66],{429:function(s,t,a){"use strict";a.r(t);var r=a(11),e=Object(r.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("p",[s._v("安装在阿里云虚拟主机环境下的Wordpress死活都发不出邮件，用户注册的邮件发不出，评论总结也发不出，等等等等，尝试了各种方法都以失败告终。今天用更改代码+SMTP插件终于试成功了，以下是解决方案。")]),s._v(" "),a("h2",{attrs:{id:"更改主机设置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#更改主机设置"}},[s._v("#")]),s._v(" 更改主机设置")]),s._v(" "),a("p",[s._v("首先阿里云虚拟主机发邮件相关的函数只开放了一个，即 "),a("code",[s._v("fsockopen")]),s._v("，默认情况下还是禁用的，所以我们要去控制台打开它（主机管理 ⇒ 站点信息 ⇒ 高级环境设置 ⇒ PHP.ini设置）。如图所示。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://static.wxsm.space/blog/48595792-3e53a900-e991-11e8-9513-b8e2070d461e.jpg",alt:""}})]),s._v(" "),a("h2",{attrs:{id:"更改wordpress代码"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#更改wordpress代码"}},[s._v("#")]),s._v(" 更改Wordpress代码")]),s._v(" "),a("p",[s._v("找到代码安装路径下的 "),a("code",[s._v("wp-includes/class-smtp.php")]),s._v(" 文件，搜索以下代码段：")]),s._v(" "),a("div",{staticClass:"language-php extra-class"},[a("pre",{pre:!0,attrs:{class:"language-php"}},[a("code",[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$this")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token property"}},[s._v("smtp_conn")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" @"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("stream_socket_client")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$host")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[s._v('":"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$errno")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$errstr")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$timeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("STREAM_CLIENT_CONNECT")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$socket_context")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("p",[s._v("将其"),a("strong",[s._v("替换")]),s._v("成：")]),s._v(" "),a("div",{staticClass:"language-php extra-class"},[a("pre",{pre:!0,attrs:{class:"language-php"}},[a("code",[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$this")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token property"}},[s._v("smtp_conn")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("fsockopen")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$errno")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$errstr")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("p",[a("strong",[s._v("注意")]),s._v("：升级Wordpress可能会导致这段修改过的代码丢失，因此可能每次Wordpress主程序升级后都要再次修改此段代码！")]),s._v(" "),a("h2",{attrs:{id:"安装smtp插件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装smtp插件"}},[s._v("#")]),s._v(" 安装SMTP插件")]),s._v(" "),a("p",[s._v("改完代码以后，到Wordpress控制台搜索插件"),a("strong",[s._v("Easy WP SMTP")]),s._v("（其它类似插件应该也行，这里以它为例），安装并启用。如图所示配置好。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://static.wxsm.space/blog/48595793-3eec3f80-e991-11e8-800e-e4dab8c116be.jpg",alt:""}})]),s._v(" "),a("p",[s._v("配置好后点击Save，保存成功后下方会有一个测试发送的表单。可以用它来测试SMTP是否已经可以正确工作。")]),s._v(" "),a("p",[s._v("如果测试邮件已经可以正常发送接收，则说明Wordpress的其它邮件也都可以正常收发了。")]),s._v(" "),a("p",[s._v("另外，本人测试过使用QQ和126的SMPT服务器，均以失败告终，原因未知。")]),s._v(" "),a("h2",{attrs:{id:"问题待解决"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#问题待解决"}},[s._v("#")]),s._v(" 问题待解决")]),s._v(" "),a("p",[s._v("现在Wordpress主程序是可以正常发邮件了，但是"),a("strong",[s._v("BackWPup")]),s._v("插件的邮件依然是完全发不出去，使用它提供的所有方式都不行，使用同样的SMTP配置也是不行，它也没有提供什么有用的错误信息，完全摸不着头脑。")]),s._v(" "),a("p",[s._v("为什么需要这个插件发邮件呢。因为它是网站的备份主力，但是因为邮件发不出去的关系，不能通过邮件发送备份，只能备份到主机的文件夹下。这样就很没安全感了，要完蛋都是一锅端的感觉，有无备份没什么区别。它提供的其它方案也好像都被墙了，比如Dropbox什么的。")]),s._v(" "),a("p",[s._v("这个问题待解决。")])])}),[],!1,null,null,null);t.default=e.exports}}]);